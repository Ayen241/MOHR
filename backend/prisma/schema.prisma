// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// Enums
enum UserRole {
  ADMIN
  MANAGER
  EMPLOYEE
}

enum EmployeeStatus {
  ACTIVE
  INACTIVE
  ON_LEAVE
}

enum LeaveType {
  VACATION
  SICK
  PERSONAL
  MATERNITY
  PATERNITY
  UNPAID
}

enum LeaveStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  LATE
  HALF_DAY
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
}

// Models
model User {
  id         String   @id @default(cuid())
  email      String   @unique
  password   String
  firstName  String
  lastName   String
  role       UserRole @default(EMPLOYEE)
  department String?
  phone      String?
  avatar     String?
  active     Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Relations
  employee       Employee?
  approvedLeaves LeaveRequest[] @relation("ApprovedBy")
  createdRooms   Room[]         @relation("CreatedBy")

  @@index([email])
  @@index([role])
}

model Employee {
  id           String         @id @default(cuid())
  employeeId   String         @unique // EMP001, EMP002, etc
  userId       String         @unique
  position     String
  hireDate     DateTime
  status       EmployeeStatus @default(ACTIVE)
  reportingTo  String? // Manager's userId
  leaveBalance LeaveBalance?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt

  // Relations
  user          User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  leaveRequests LeaveRequest[]
  attendances   Attendance[]
  roomBookings  RoomBooking[]

  @@index([employeeId])
  @@index([status])
}

model LeaveBalance {
  id           String   @id @default(cuid())
  employeeId   String   @unique
  year         Int
  vacationDays Int      @default(20)
  sickDays     Int      @default(10)
  personalDays Int      @default(3)
  usedVacation Int      @default(0)
  usedSick     Int      @default(0)
  usedPersonal Int      @default(0)
  updatedAt    DateTime @updatedAt

  // Relations
  employee Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@index([employeeId])
  @@index([year])
}

model LeaveRequest {
  id              String      @id @default(cuid())
  employeeId      String
  leaveType       LeaveType
  startDate       DateTime
  endDate         DateTime
  reason          String
  attachment      String?     // File path for attachment
  status          LeaveStatus @default(PENDING)
  approvedBy      String? // User ID of approver
  approvalDate    DateTime?
  rejectionReason String?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  // Relations
  employee Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  approver User?    @relation("ApprovedBy", fields: [approvedBy], references: [id])

  @@index([employeeId])
  @@index([status])
  @@index([startDate])
}

model Attendance {
  id           String           @id @default(cuid())
  employeeId   String
  date         DateTime         @db.Date
  checkInTime  DateTime?
  checkOutTime DateTime?
  status       AttendanceStatus @default(ABSENT)
  notes        String?
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt

  // Relations
  employee Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@unique([employeeId, date])
  @@index([employeeId])
  @@index([date])
}

model Room {
  id        String   @id @default(cuid())
  name      String   @unique
  capacity  Int
  location  String
  amenities String   @default("") // JSON string: ["projector", "whiteboard"]
  status    String   @default("AVAILABLE")
  createdBy String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  creator  User          @relation("CreatedBy", fields: [createdBy], references: [id])
  bookings RoomBooking[]

  @@index([status])
}

model RoomBooking {
  id         String        @id @default(cuid())
  roomId     String
  employeeId String
  bookedDate DateTime      @db.Date
  startTime  DateTime
  endTime    DateTime
  purpose    String
  status     BookingStatus @default(PENDING)
  notes      String?
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt

  // Relations
  room     Room     @relation(fields: [roomId], references: [id], onDelete: Cascade)
  employee Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@index([roomId])
  @@index([employeeId])
  @@index([bookedDate])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  createdAt    DateTime @default(now())

  @@index([userId])
}

model Settings {
  id        String   @id @default(cuid())
  // General Settings
  companyName    String   @default("MoHR Systems")
  companyEmail   String   @default("admin@mohr.com")
  companyAddress String   @default("")
  timezone       String   @default("UTC")
  dateFormat     String   @default("MM/DD/YYYY")
  
  // Security Settings
  sessionTimeout Int     @default(30) // minutes
  require2FA     Boolean @default(false)
  ipWhitelist    Boolean @default(false)
  
  // Notification Settings
  notifyLeaveRequests   Boolean @default(true)
  notifyAttendanceAlert Boolean @default(true)
  notifySystemUpdates   Boolean @default(true)
  notifyBirthdays       Boolean @default(true)
  
  updatedAt DateTime @updatedAt
  createdAt DateTime @default(now())
}
